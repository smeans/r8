const os = require('os');

const process = require('process');

const log = require('log');
const au = require('apputil');

module.exports = (function () {
  try {
    const sc = require('../../server-config.json');

    if (!sc.shared) {
      log.error('malformed server-config.json: missing shared key');

      return null;
    }

    let rc = sc.shared;
    rc.env = process.env.NODE_ENV || 'development';

    if (sc.env_specific && sc.env_specific.hasOwnProperty(rc.env)) {
        rc = Object.assign(rc, sc.env_specific[rc.env]);
    }

    const scl = require('../../../server-config-local.json');

    rc = au.replaceTokens(rc, scl);

    return rc;
  } catch (e) {
    log.error('error loading configuration: ', e.message);

    return null;
  }
})();
